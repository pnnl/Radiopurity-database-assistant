<!DOCTYPE html>
<html>

<head>
<title>XIA Search</title>
<link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='styles/styles.css') }}">
</head>

<body>

<!-- display logos for snolab, pnnl, and radiopurity -->
<div class="logo-container">
    <img src="{{ url_for('static', filename='logos/pnnl_logo.png') }}"/>
</div>
<div class="logo-container">
    <img src="{{ url_for('static', filename='logos/radiopurity_logo.png') }}"/>
</div>
<div class="logo-container">
    <img src="{{ url_for('static', filename='logos/snolab_logo.png') }}"/>
</div>

<!-- documentation link -->
<div>
    <a class="normal-text github-link" href="{{ url_for('static', filename='docs/html/index.html') }}" target="_blank">documentation</a>
</div>
<div class="clear-float"></div>

<!-- github link -->
<div>
    <a class="github-link" href="https://github.com/pnnl/Radiopurity-database-assistant" target="_blank" rel="noopener noreferrer">
        <img class="github-logo" src="{{ url_for('static', filename='logos/github_logo.png') }}" alt="GitHub logo">
    </a>
</div>
<div class="clear-float"></div>

<!-- links to other pages on the site -->
<div>
    <a href="{{ url_for('about_endpoint') }}"><button class="logout-link">about</button></a>
    <a href="{{ url_for('simplesearch_endpoint') }}"><button class="pages">search</button></a>
    <a href="{{ url_for('xia_insert_endpoint') }}"><button class="pages">insert</button></a>
    <a href="{{ url_for('update_endpoint') }}"><button class="pages">update</button></a>
    <a href="{{ url_for('logout') }}"><button class="logout-link">logout</button></a>
</div>


<h1>Query Assistant</h1>

<!--<h3>this UI queries the {{db_name}} database</h3>-->
<!--<p class="info">Note that this search assistant only performs simple queries; if you wish to perform a nested query or a query with complicated "AND" and "OR" functionality, you are advised to use the DUNEdb python toolkit to query for all records and then filter the records (returned as JSON) as you desire.</p>-->

<div>
    <div class="logo-container right-aligned">
        <img src="{{ url_for('static', filename='logos/conversion_chart.png') }}"/>
    </div>
    <div class="clear-float">
</div>

<div class="section-container">
    <form action="{{ url_for('simplesearch_endpoint') }}" method="POST">

        <div class="centered-div">
            <p class="info">Search for records containing the term...</p>
            <div>
                <textarea class="hidden-object" name="query_field" rows="1" cols="5" readonly>all</textarea>
                <textarea class="hidden-object" name="comparison_operator" rows="1" cols="5" readonly>contains</textarea>
            </div>
            <div>
                <textarea id="query_value" name="query_value" rows="1" style="width:100%;"></textarea>
            </div>
            <div>
                <span class="left-aligned">
                    <input id="submit-query" class="submit-button" type="submit" value="search">
                </span>
                <span class="right-aligned">
                    <a href="{{ url_for('search_endpoint') }}">
                        <p class="normal-text">advanced search</p>
                    </a>
                </span>
            </div>
            <div class="clear-float"></div>
        </div>
    </form>
</div>

{% if error_msg|length %}
    <div class="section-container">
        <p class="normal-text">query error: {{error_msg}}</p>
    </div>
{% endif %}

<div id="query-results-container" class="section-container">
    {% if results_str|length %}
        <h3>RESULTS</h3>
        <p class="info">num records: {{results_str|length}}</p>
        {% for result in results_str %}
            <!--<button type="button" class="collapsible">{{result|truncate(100, True)}}</button> -->
            
             <!-- {% set result_dict = results_dict[loop.index-1] %} -->
                
            <button type="button" class="collapsible">
                <span class="collapsiblebutton-name"><b>Sample:</b> {{ result_dict["Sample"] }}</span>
                <span class="collapsiblebutton-name"><b>Experiment:</b> {{ result_dict["Experiment"] }}</span>
                <span class="collapsiblebutton-name"><b>Sample material:</b> {{ result_dict["Sample material"] }}</span>
            </button>
            
            <div class="collapsible-content">
                <div class="collapsible-line">
                    <p class="collapsible-field">database id:</p>
                    <p class="collapsible-value">{{ result_dict["_id"] }}</p>
                </div>
                <div class="collapsible-line">
                    <p class="collapsible-field">Experiment:</p>
                    <p class="collapsible-value">{{ result_dict["Experiment"] }}</p>
                </div>
                
                {% for key in result_dict.keys() %}
                    {% if key == "Energy Range (MeV)" %}
                        <div class="collapsible-line">
                            <p class="collapsible-field">Energy Range (MeV):</p>
                        </div>
                        {% for range in result_dict[key].keys() %}
                            <div class="collapsible-line">
                                    <p class="collapsible-field"> {{ range }}</p>
                                    <p class="collapsible-value">{{ result_dict[key][range] }}</p>
                                </div>
                        {% endfor %}                       
                    {% elif key not in ['_id', '_version', 'parent_id'] %}
                        <div class="collapsible-line">
                            <p class="collapsible-field">{{ key }}: </p>
                            <p class="collapsible-value">{{ result_dict[key] }}</p>
                        </div>
                    {% endif %}
                {% endfor %}
                
            </div>
        {% endfor %}
    {% endif %}
</div>

<script>
    var coll = document.getElementsByClassName("collapsible");
    var i;

    for (i = 0; i < coll.length; i++) {
        coll[i].addEventListener("click", function() {
            this.classList.toggle("active");
            var content = this.nextElementSibling;
            if (content.style.display === "block") {
                content.style.display = "none";
            } else {
                content.style.display = "block";
            }
        });
    }
</script>

</body>
</html>


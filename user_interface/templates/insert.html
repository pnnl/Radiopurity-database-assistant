<!DOCTYPE html>
<html>

<head>
    <script type="text/javascript" src="{{ url_for('static', filename='javascript_funcs.js') }}"></script>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='styles/styles.css') }}">
</head>

<body>

<!-- display logos for snolab, pnnl, and radiopurity -->
<div class="logo-container">
    <a href="https://www.pnnl.gov/" target="_blank">
        <img id="pnnl-logo-link" src="{{ url_for('static', filename='logos/pnnl_logo.png') }}"/>
    </a>
</div>
<div class="logo-container">
    <img src="{{ url_for('static', filename='logos/radiopurity_logo.png') }}"/>
</div>
<div class="logo-container">
    <a href="https://www.snolab.ca/" target="_blank">
        <img id="snolab-logo-link" src="{{ url_for('static', filename='logos/snolab_logo.png') }}"/>
    </a>
</div>

<!-- links to other pages on the site -->                                             
<div>                                                                                 
    <a href="{{ url_for('about_endpoint') }}"><button class="logout-link">about</button></a>
    <a href="{{ url_for('simplesearch_endpoint') }}"><button class="pages">search</button></a>
    <a href="{{ url_for('search_endpoint') }}"><button class="pages">advanced search</button></a>
    <a href="{{ url_for('insert_endpoint') }}"><button class="pages">insert</button></a>   
    <a href="{{ url_for('update_endpoint') }}"><button class="pages">update</button></a>
    <a href="{{ url_for('logout_endpoint') }}"><button class="logout-link" onclick="performLogout()">logout</button></a>
</div>

<h1>Insertion Assistant</h1>

<!--<h3>documents are inserted into the {{db_name}} database</h3>-->
<div>
    <div class="logo-container right-aligned">
        <img src="{{ url_for('static', filename='logos/conversion_chart.png') }}"/>
    </div>
    <div class="clear-float">
</div>

{% if new_doc_msg|length > 0 %}
    <div class="section-container">
        <h3>{{new_doc_msg}}</h3>
    </div>
{% endif %}

<form name="new_record_vals" action="{{ url_for('insert_endpoint') }}" method="POST">
    <div class="section-container">
        <div id="input-section">
            <div>
                <span>
                    <p class="normal-text">experiment name or similar: <input type="text" name="grouping"></p>
                </span>
            </div>

            <h3>sample:</h3>
            <div>
                <span>
                    <p class="normal-text">concise sample description: <input type="text" name="sample.name"></p>
                </span>
            </div>
            <div>
                <span>
                    <p class="normal-text">detailed sample description: <input type="text" name="sample.description"></p>
                </span>
            </div>
            <div>
                <span>
                    <p class="normal-text">where the sample came from: <input type="text" name="sample.source"></p>
                </span>
            </div>
            <div>
                <span>
                    <p class="normal-text">sample identification number: <input type="text" name="sample.id"></p>
                </span>
            </div>
            <div>
                <span>
                    <p class="normal-text">name of the person/people who own the sample: <input type="text" name="sample.owner.name"></p>
                </span>
            </div>
            <div>
                <span>
                    <p class="normal-text">email or telephone of the person/people who own the sample: <input type="text" name="sample.owner.contact"></p>
                </span>
            </div>

            <h3>data source</h3>
            <div>
                <span>
                    <p class="normal-text">reference for where the data came from: <input type="text" name="data_source.reference"></p>
                </span>
            </div>
            <div>
                <span>
                    <p class="normal-text">name of the person/people who performed data input: <input type="text" readonly value="{{username}}" name="data_source.input.name"></p>
                </span>
                <span>
                    <p class="info">non-modifiable</p>
                </span>
            </div>
            <div>
                <span>
                    <p class="normal-text">email or telephone of the person/people who performed data input: <input type="text" name="data_source.input.contact"></p>
                </span>
            </div>
            <div>
                <span>
                    <p class="normal-text">data input date: <input type="text" readonly value="{{data_insert_date}}" name="data_source.input.date"></p>
                </span>
                <span>
                    <p class="info">non-modifiable</p>
                </span>
            </div>
            <div>
                <span>
                    <p class="normal-text">data input notes: <input type="text" name="data_source.input.notes"></p>
                </span>
                <span>
                    <p class="info">help: simplifications or assumptions</p>
                </span>
            </div>

            <h3>measurement</h3>
            <div>
                <span>
                    <p class="normal-text">name of the person/people who did the measurement: <input type="text" name="measurement.practitioner.name"></p>
                </span>
            </div>
            <div>
                <span>
                    <p class="normal-text">email or telephone of the person/people who did the measurement: <input type="text" name="measurement.practitioner.contact"></p>
                </span>
            </div>
            <div>
                <span>
                    <p class="normal-text">measurement technique: <input type="text" name="measurement.technique"></p>
                </span>
            </div>
            <div>
                <span>
                    <p class="normal-text">institution name: <input type="text" name="measurement.institution"></p>
                </span>
            </div>
            <div>
                <span>
                    <p class="normal-text">measurement date: 
                        <span class="invalid-field-tooltip" id="invalid-meas-date-tooltip">
                            <input type="text" name="measurement.date" onKeyup="tryEnableSubmit()">
                            <span class="invalid-field-tooltip-text info" id="invalid-meas-date-tooltip-text">invalid date format</span>
                        </span>
                    </p>
                </span>
            </div>
            <div>
                <span>
                    <p class="normal-text">detailed measurement description: <input type="text" name="measurement.description"></p>
                </span>
            </div>
            <div>
                <span>
                    <p class="normal-text">name of the person/people who coordinated the measurement: <input type="text" name="measurement.requestor.name"></p>
                </span>
            </div>
            <div>
                <span>
                    <p class="normal-text">email or telephone of the person/people who coordinated the measurement: <input type="text" name="measurement.requestor.contact"></p>
                </span>
            </div>

            <h3>measurement results</h3>
            <h5>result</h5>
            <div>
                <span>
                    <!--<p class="normal-text">isotope: <input type="text" name="measurement.results.isotope1" onKeyup="tryEnableSubmit()"></p>-->
                    <p class="normal-text">isotope:
                        <span class="invalid-field-tooltip" id="invalid-isotope1-tooltip">
                            <input type="text" name="measurement.results.isotope1" onKeyup="tryEnableSubmit()">
                            <span class="invalid-field-tooltip-text info" id="invalid-isotope1-tooltip-text">invalid isotope</span>
                        </span>
                    </p>
                </span>
            </div>
            <div>
                <span>
                    <p class="normal-text">measurement type: 
                        <select name="measurement.results.type1">
                            <option value="measurement">measurement</option>
                            <option value="limit">limit</option>
                            <option value="range">range</option>
                        </select>
                    </p>
                </span>
            </div>
            <div>
                <span>
                    <p class="normal-text">units: 
                        <select name="measurement.results.unit1">
                            <option value="Bq/kg">Bq/kg</option>
                            <option value="mBq/kg">mBq/kg</option>
                        </select>
                    </p>
                </span>
            </div>
            <div>
                <span>
                    <span class="fourths-container">
                        <p class="normal-text">value(s):</p> 
                    </span>
                    <span class="fourths-container">
                        <div>
                            <input type="text" name="measurement.results.valueA1">
                            <p class="info">if type is "measurement" this is the central value. If type is "limit" this is the upper limit. If type is "range" this is the lower bound. </p>
                        </div>
                    </span>
                    <span class="fourths-container">
                        <div>
                            <input type="text" name="measurement.results.valueB1">
                            <p class="info">if type is "measurement" this is the symmetric error. If type is "limit" this is the confidence level. If type is "range" this is the upper bound. </p>
                        </div>
                    </span>
                    <span class="fourths-container">
                        <div>
                            <input type="text" name="measurement.results.valueC1">
                            <p class="info">if type is "measurement" this is the asymmetric error. If type is "limit" no value is required. If type is "range" this is the confidence level. </p>
                        </div>
                    </span>
                </span>
            </div>

        </div>

        <div>
            <span>
                <button id="add-meas-button" class="normal-button" type="button">add measurement result</button>
            </span>
            <span>
                <button id="remove-meas-button" class="normal-button" type="button">remove measurement result</button>
            </span>
        </div>

        <div>
            <span>
                <input id="submit-record-button" class="submit-button" type="submit" value="insert" disabled="disabled">
            </span>
        </div>
    </div>
</form>

<script>
    var counter = 2;
    var add_button = document.getElementById("add-meas-button")
    add_button.addEventListener('click', function () {
        var measStr = '<h5>additional result</h5>'
        measStr += '<p class="normal-text">isotope: <span class="invalid-field-tooltip" id="invalid-isotope' + counter + '-tooltip"><input type="text" name="measurement.results.isotope' + counter + '" onKeyup="tryEnableSubmit()"><span class="invalid-field-tooltip-text info" id="invalid-isotope' + counter + '-tooltip-text">invalid isotope</span></span></p>'
        //measStr += '<div><span><p class="normal-text">isotope: <input type="text" name="measurement.results.isotope' + counter + '" onKeyup="tryEnableSubmit()"></p></span></div>'
        measStr += '<div><span><p class="normal-text">measurement type: <select name="measurement.results.type' + counter + '"><option value="measurement">measurement</option>'
        measStr += '<option value="limit">limit</option><option value="range">range</option></select></p></span></div>'
        measStr += '<div><span><p class="normal-text">units: <select name="measurement.results.unit' + counter + '">'
        measStr += '<option value="Bq/kg">Bq/kg</option><option value="mBq/kg">mBq/kg</option></select></p></span></div>'
        measStr += '<div><span><span class="fourths-container"><p class="normal-text">value(s):</p></span>'
        measStr += '<span class="fourths-container"><div><input type="text" name="measurement.results.valueA' + counter + '">'
        measStr += '<p class="info">if type is "measurement" this is the central value. If type is "limit" this is the upper limit. If type is "range" this is the lower bound. </p></div></span>'
        measStr += '<span class="fourths-container"><div><input type="text" name="measurement.results.valueB' + counter + '">'
        measStr += '<p class="info">if type is "measurement" this is the symmetric error. If type is "limit" this is the confidence level. If type is "range" this is the upper bound. </p></div></span>'
        measStr += '<span class="fourths-container"><div><input type="text" name="measurement.results.valueC' + counter + '">'
        measStr += '<p class="info">if type is "measurement" this is the asymmetric error. If type is "limit" no value is required. If type is "range" this is the confidence level. </p></div></span>'
        measStr += '</span></div>'
        var newMeas = document.createElement('div');
        newMeas.setAttribute('id', 'new-meas-ele-'+counter);
        newMeas.innerHTML = measStr;

        var input_section = document.getElementById("input-section");
        input_section.appendChild(newMeas);

        counter++;
    });

    var remove_button = document.getElementById("remove-meas-button")
    remove_button.addEventListener('click', function() {
        counter--;
        console.log('new-meas-ele-'+counter);
        var removeDiv = document.getElementById('new-meas-ele-'+counter);
        removeDiv.parentNode.removeChild(removeDiv);
    });
</script>

</body>
</html>

